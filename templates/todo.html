{% extends "base.html" %}

{% block title %}To-Do List{% endblock %}

{% block content %}
    <h1 class="text-center mb-4">To-Do List</h1>
    <h2 class="text-center mb-4">Welcome, {{ current_user.email }}</h2>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="mb-4 p-2 text-center text-white rounded 
                    {{ 'bg-red-500' if category == 'danger' else 'bg-yellow-500' if category == 'warning' else 'bg-green-500' }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Add Task Form -->
    <form method="POST" action="{{ url_for('todo') }}" class="mb-4">
        <div class="input-group flex space-x-2">
            <input type="text" name="content" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500" placeholder="Add a new task" required>
            <button type="submit" class="bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700">Add Task</button>
        </div>
    </form>

    <!-- Task List -->
    <div class="list-group">
        {% for task in tasks %}
            <div class="list-group-item task-item p-4 mb-2 border rounded {% if task.completed %}bg-gray-200{% endif %}">
                <span class="text-lg">{{ task.content }}</span>
                <div class="task-actions mt-2 flex space-x-2">
                    <!-- Toggle Completion Form -->
                    <form method="POST" action="{{ url_for('update', task_id=task.id) }}" style="display:inline;">
                        <button type="submit" class="bg-blue-600 text-white py-1 px-3 rounded-md hover:bg-blue-700">
                            {{ 'Mark Incomplete' if task.completed else 'Mark Complete' }}
                        </button>
                    </form>
                    <!-- Delete Form with Confirmation -->
                    <form method="POST" action="{{ url_for('delete', task_id=task.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this task?');">
                        <button type="submit" class="bg-red-600 text-white py-1 px-3 rounded-md hover:bg-red-700">Delete</button>
                    </form>
                    <!-- Edit Form -->
                    <form method="POST" action="{{ url_for('edit', task_id=task.id) }}" style="display:inline;">
                        <div class="flex space-x-2">
                            <input type="text" name="content" class="border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-blue-500" placeholder="Edit task" value="{{ task.content }}">
                            <button type="submit" class="bg-gray-600 text-white py-1 px-3 rounded-md hover:bg-gray-700">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Logout Button -->
    <div class="text-center mt-4">
        <a href="{{ url_for('logout') }}" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">Logout</a>
    </div>
{% endblock %}